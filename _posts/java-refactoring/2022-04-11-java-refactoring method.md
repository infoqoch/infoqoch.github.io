---
layout: post
author: infoqoch
title: 자바, 리팩터링, 메서드 정리 Composing Methods
published: false
categories: [java]
tags: [java, refactoring]
---

## 메서드 정리, 리팩토링의 가장 중요하고 쉬운 방법
- 리팩토링의 많은 부분이 메서드를 정리하고 코드를 적절하게 포장하는 것이다. 

### 메서드 정리의 기본, Extract Method
- 메서드 정리의 기본은 길고 복잡한 메서드를 별도의 메서드로 뽑아내는 작업이다. 이를 Extract Method라 한다. 
- Extract Method에 대한 나의 첫 느낌은, 다소 과도하게 추출하지 않냐는 생각을 했다. 단 한 줄이라도 공통의 로직을 사용하거나, 하나의 지역 변수가 한 코드 뭉치에 중복되어 사용될 가능성이 있으면, 저자는 다른 메서드로 추출했다. 심지어 동일한 연산을 반복하더라도 메서드로 추출했다. 반복적으로 연산을 수행하도록 코드를 작성했다. 
- 중복된 연산으로 인한 성능 상 문제가 있을 수 있다. 하지만 최적화에 더 큰 도움을 줄 수 있다. 최적화의 대상이 무엇인지 명확하다. 단 하나의 소스만 수정하면 되기 때문이다.
- 이러한 메서드 추출의 장점은 분명하다. 하나의 메서드를 로직 여러 곳에서 공통으로 쓸 수 있다. 임시변수를 없애기 때문에 안정적인 코드 작성을 도와준다. 임시변수가 없기 때문에 리팩토링이 수월하다.
- 이펙티브자바에서는 이런 말이 있었다. 좋은 코드를 작성하면 성능은 따라온다. 성능 문제는 개발자가 코드를 읽고 직관으로 판단하는 것이 아니라 모니터링 툴을 통해 명확하게 판단해야 한다. 이러한 모니터링은 메서드가 분리된 상태에서 더 명확하게 진행할 수 있을테다. 

### 임시변수 없애기
- Extract Method의 핵심 목표 중 하나는 앞서 말한바와 같이 임시변수, 임시변수를 제거하기 위함에 있다. 
- 임시변수가 발생하는 이유 중 하나는 수식의 결과값을 저장하기 위함이다. 이러한 결과값을 노출시키지 않고 메서드의 결과값으로 리턴한다. 이를 Replace Temp with Query 라 한다. 

### 임시변수가 명확하면 차라리...
- 메서드 추출이 핵심이지만 필요하다면 메서드를 없앤다. inline method가 대표적이다. 
- 메서드로 추출하기 애매하지만 로직으로 보여주기엔 어떤 내용을 보여주고 싶은지 애매한 경우가 있다. 이런 경우 차라리 임시변수로 추출하여 명확하게 한다. 이를 Introduce Explaining Variable 이라 한다. 

```java
// Introduce Explaining Variable

if( ( platform.toUpperCase().indexOf("MAC") > -1 ) &&
    ( browser.toUpperCase().indexOf("IE") > -1 ) &&
    ( wasInitialized() && resized > 0 )
{
    // 작업...
}

final boolean isMasOS = platform.toUpperCase().indexOf("MAC") > -1;
final boolean isIEBrowser = browser.toUpperCase().indexOf("IE") > -1;
final boolean wasResized = 0;

if( isMacOS && isIEBrowser && wasInitialized() && wasResized )
{
    // 작업...
}
```

## 리팩토링에 앞서
- 리팩토링의 전제조건이 테스트코드라 한다. 
- 테스트코드 이외에 제거하려는 임시 변수에 final을 부여하고, 해당 변수에 대입되는 경우가 있는지를 확인한다. 컴파일과 테스트를 수시로 사용한다. 
- 리팩토링의 과정은 매우 신중하고 천천히 이뤄진다. 이러한 호흡이 짧고 점진적인 방식이, 리팩토링으로 인한 사이드이펙트를 최소화할 수 있다. 

## 나아가며
- 마틴 파울러의 리팩터링 1판이 절판되었다. 운이 좋게 중고를 구매할 수 있었다. 
- 나는 일종의 편집증이 있다. 책을 읽고 정리하지 않으면 바로 휘발될 것 같다는 공포를 가지고 있다. 
- 한편, 책 리팩터링은 블로그에 정리하기에 다소 까다롭다. 이펙티브자바는 장마다의 분리가 명확하고 이해한 바를 나의 코드로 반영하기에 좋았다. 나만의 코드로 정리하는 과정에서 더 깊은 이해를 할 수 있었다.
- 리팩터링의 경우 이펙티브자바와 달리 요구하는 코드의 양이 훨씬 많다. 만약 내가 나만의 코드로 구현하려면 상당한 시간이 걸릴 것 같다는 느낌을 많이 받았다. 이와 반대로 리팩터링에서 사용하는 리팩터링 기술은 책을 읽기 전에 스스로 하던 방식들이 반절정도 되었다. 이러한 내용을 다 정리하는 것이 좋은 방식이냐에 대한 의문이 있었다.
- 그래서 결론적으로 각 장마다 내가 인상적이었던 부분을 간략하게 정리하는 방식으로 블로깅하기로 결정했다. 