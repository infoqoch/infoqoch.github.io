---
layout: post
author: infoqoch
title: 지킬의 검색기능 중 full-search-text 설정 과정에서 json 오류 문제
categories: [git]
tags: [jekyll]
---

## 들어가며
- 제목이 다소 장황하다. 더 나아가 지킬, 루비의 문법에 대해 잘 모른다. 그래서 아마 이 블로그 내용도 장황할 것 같다. 아무튼 현재 나의 상황을 정리코자 한다. 

## 나의 현황
- 나는 `simple-jekyll-search` 라는 기능으로 검색 기능을 추가하였다. 검색 기능이 단순하고 쉬워서 마음에 들었으나 문제는 문서 전체 검색이 되지 않았다.
- 그래서 스펙에 따라 search.json을 수정하였다. 해당 내용은 post.content 를 검색 대상으로 한다. 
- 하지만 이때 html 콘솔에서 스크립트 에러를 만들었고, 해당 내용은 json 파일을 정상적으로 가져오지 못한다는 에러였다.
- 지킬의 경우 자바의 target 처럼 _site 에 동적인 파일을 정적으로 변경한다. _site/search.json 을 열어보니, /search.json 에 따라 정의한 내용대로 나의 포스팅이 모두 저장된 것을 확인할 수 있다. 그리고 해당 파일에 대하여 vs code가 문법 오류가 있다고 한다.
- 스펙에 확인한 결과 필터를 사용할 수 있고, 필터는 문제되는 것에 대하여 이스케이프 처리를 한다.
- 그러나 기본적으로 제공하는 것은 `strip_control_and_extended_characters` 의 메서드를 통해 아스키가 아니거나 char(int) 의 32-126 이 아닌 값을 없애는 것으로 보인다. 사실상 영어 이외에 모든 것에 대하여 필터링 처리한다. 
- 결과적으로 해당 매서드를 삭제한 결과 해결할 수 있었다! 너무 행복하다.

### 커스텀 필터의 적용
- [프로젝트의 깃]("https://github.com/christian-fei/Simple-Jekyll-Search") 에 들어간다.
- 설명서나 깃에서 /example 의 내용을 참고하여 검색 기능을 추가한다.
- full-text-search 의 내용을 참고하여 search.json 을 수정한다.
- 필터 역시 자신의 블로그에 넣는다. 그 파일은 해당 프로젝트 깃 리포지토리의 /example/plugins 에 있다.
- simple_search_filter.rb 에서 remove_chars 을 정의하는 것 중  strip_control_and_extended_characters 부분을 삭제한다.
- 그리고 반드시 지킬 서버를 죽였다가 살린다. 자동 빌드로는 해당 변경 내용을 반영할 수 없다.

### 깃 페이지에서는 커스텀필터가 적용되지 않는다.
- 위의 방식으로는 로컬로 정상작동하는데 깃페이지에서는 도저히 정상작동을 하지 않았다. 그래서 지킬의 공식문서를 읽었고, 커스텀 필터를 깃페이지에서는 적용할 수 없다고 한다. 아 ㅠ. 그말인즉슨 깃페이지와 관련하여 외부 필터를 적용한 많은 블로그의 방식이 사실은 정상 작동하지 않을 가능성이 높다는 점이다. 깃페이지를 만드는 분들은 나와 같은 삽질을 하지 않기를 바라며 이 내용을 추가한다ㅠ.  아무튼, 
- 지금까지 봐왔던 많은 코드들은 사실 리퀴드라는 문법으로 작성되었다. 외부 메서드처럼 사용했던 것은 리퀴드 문법을 외부 파일로 만든 것에 불과했다. 이 문제를 해소하기 위해서는 리퀴드에 대한 지식을 필요로 했다. [지킬](https://jekyllrb.com/docs/liquid/filters/), [리퀴드](https://shopify.github.io/liquid/filters/remove/). 특히 지킬에서는 깃페이지와 관련한 내용이 있기 때문에, 뭔가 잘 안되면 지킬 홈페이지를 자세히 읽어보자. 그리고 해당 문법은 생각보다 어렵지 않기 때문에 쉽게 적용할 수 있을 것이다.
- 내가 적용한 내용은 search.json 에서 참고 바란다. 위의 내용을 알고 싶지 않으면 그냥 쿨하게 복사 붙여넣기 추천한다.

## 교훈
- 결국 날로 먹으려던 나의 노력은 실패했다. 상당한 시간동안 삽질을 했고, 결국 해결했다. 역시 기초부터 튼튼인가? Liquid 문법에 대하여 알게 되었다. 아직 지킬 프레임워크에 대해서 잘 모르겠다. 그러나 나중에 문제가 생기면 지금보다 더 잘 대응할 수 있을 것 같다.
- json에서 이스케이프처리를 해야함을 이번에 배웠다. 사실은 그냥 생각 없이 써왔는데, 이런 부분에서 문제가 있을 수 있음을 배웠다. 